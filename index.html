<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Vocabulary Audio Quiz</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f4f8;
            color: #333;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 600px;
            width: 90%;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        h1 { margin-bottom: 20px; font-size: 1.5rem; color: #2c3e50; }
        
        /* Quiz Content Areas */
        .content-area {
            margin: 20px 0;
            cursor: pointer;
            padding: 20px;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent; /* iOS tap highlight remove */
        }
        .content-area:hover {
            background-color: #f8fafc;
            border-color: #a0aec0;
        }
        .word-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2b6cb0;
            margin-bottom: 15px;
            min-height: 3.5rem;
        }
        .def-display {
            font-size: 1.2rem;
            color: #4a5568;
            line-height: 1.5;
            min-height: 3rem;
        }
        .hint-text {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Controls */
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 12px 24px; /* Larger touch target for mobile */
            font-size: 1rem;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #4299e1;
            color: white;
            transition: background 0.2s;
            touch-action: manipulation;
        }
        button:hover { background-color: #3182ce; }
        button:disabled { background-color: #cbd5e0; cursor: not-allowed; }
        
        .shuffle-box {
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .status {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 0.8rem;
            color: #a0aec0;
        }
    </style>
</head>
<body>

    <div class="shuffle-box">
        <label>
            <input type="checkbox" id="shuffleCheck"> „Ç∑„É£„ÉÉ„Éï„É´ (Shuffle)
        </label>
    </div>

    <div class="container" id="quizCard">
        <div class="status" id="counter">0 / 0</div>
        
        <h1>Listening Vocabulary Quiz</h1>
        
        <div class="content-area" onclick="revealAnswer()">
            <div id="wordText" class="word-display">???</div>
            <div id="defText" class="def-display">Click to see answer</div>
            <div class="hint-text">(Click card or press Space to reveal)</div>
        </div>

        <div class="controls">
            <button onclick="startQuiz()" id="startBtn">Start / Restart</button>
            <button onclick="playAudio()" id="replayBtn" disabled>üîä Replay Audio</button>
            <button onclick="nextQuestion()" id="nextBtn" disabled>Next ‚û°</button>
        </div>
    </div>

    <script>
        // Data from PDF Sources
        const vocabData = [
            // --- KSB (Topic 8) ---
            { w: "bowing", d: "bending the body forward from the waist as a social gesture/greeting" },
            { w: "is important", d: "matters" },
            { w: "a candidate", d: "applicant" },
            { w: "prompting", d: "causing an action" },
            { w: "hire", d: "employ, give a job to" },
            { w: "minefield", d: "a situation with many hidden problems" },
            { w: "uniformity", d: "sameness" },
            { w: "paramount", d: "of main importance" },
            { w: "ensemble", d: "entire costume" },
            { w: "loud", d: "colorful, showy" },
            { w: "according to", d: "as stated or reported by" },
            { w: "frowned upon", d: "to show disapproval" },
            { w: "associated with", d: "linked together (in one's mind)" },
            { w: "vacant", d: "empty, not occupied" },
            { w: "consent", d: "permission" },
            { w: "warned", d: "advised, cautioned" },
            { w: "regarded as", d: "considered to be" },
            { w: "superiors", d: "people in a higher rank, grade or age" },

            // --- The Bucket List ---
            { w: "take on", d: "to be willing or ready to do something" },
            { w: "mentality", d: "a mindset; a way of thinking" },
            { w: "launch", d: "to start (a plan, a program, etc.)" },
            { w: "consistently", d: "in every case; on every occasion" },
            { w: "attuned to", d: "aware of; able to recognize and understand" },
            { w: "inclined to", d: "likely to do" },
            { w: "hinder", d: "to make it difficult for something to happen" },
            { w: "appoint", d: "to give someone a job or position" },
            { w: "throw oneself into", d: "to do something actively, enthusiastically" },
            { w: "daunting", d: "seems difficult, intimidating" },
            { w: "forage", d: "to search for food in nature" },
            { w: "stricture", d: "a rule; a restriction" },
            { w: "obsessive", d: "thinking/worrying about something too much" },
            { w: "roam", d: "to wander freely" },
            { w: "shrink", d: "to become smaller" },
            { w: "perceived", d: "thought to be; imagined to be" },
            { w: "consequence", d: "a result" },
            { w: "sedentary", d: "not active" },
            { w: "obesity", d: "being overweight" },
            { w: "determine", d: "to discover a fact; to find out" },
            { w: "reminisce", d: "to remember past events in a positive way" },
            { w: "compile", d: "to gather; to create a list of things" },
            { w: "whittle down", d: "to gradually reduce in number" },
            { w: "reveal", d: "to make (previously unknown information) known" },

            // --- Lefties and Righties ---
            { w: "to an extent", d: "to some degree, not completely" },
            { w: "influenced by", d: "affected by" },
            { w: "drawn to", d: "attracted to" },
            { w: "one another", d: "each other" },
            { w: "measure", d: "evaluate" },
            { w: "hypothesis", d: "an explanation based on limited evidence" },
            { w: "righty / lefty", d: "right-handed/left-handed person" },
            { w: "tend to", d: "likely to" },
            { w: "dominant", d: "stronger, main" },
            { w: "perceive", d: "recognize" },
            { w: "come to", d: "gradually reach a particular stage" },
            { w: "associate", d: "to connect something in your mind with something else" },
            { w: "roughly", d: "approximately, about" },
            { w: "politicians", d: "members of government, public servants" },
            { w: "differentiate", d: "find the difference between things" },
            { w: "candidate", d: "a person who may to be selected for a position/job" },
            { w: "extends to", d: "includes" },
            { w: "participants", d: "people who take part in something" },
            { w: "applicants", d: "people who are trying for a position/job" },
            { w: "regularly", d: "very often" },
            { w: "extends beyond", d: "goes further than" },
            { w: "abstract", d: "existing as an idea or feeling (not a physical object)" },
            { w: "like", d: "such as; for example" },
            { w: "hold true", d: "be a fact" },
            { w: "absolute", d: "at the greatest degree possible" },
            { w: "temporarily", d: "for a certain period of time, not permanently" },

            // --- Historical Preservation ---
            { w: "preservation", d: "the act of keeping something in good condition" },
            { w: "desire", d: "a strong wish or feeling that you want something" },
            { w: "heritage", d: "traditions/languages/buildings handed down from the past" },
            { w: "argument", d: "a statement or reason for/against a point" },
            { w: "architecture", d: "the character/style of a building" },
            { w: "reinforce", d: "make stronger" },
            { w: "significant", d: "large in amount/quantity" },
            { w: "generates", d: "creates/produces" },
            { w: "revenue", d: "money received" },
            { w: "upkeep", d: "repairs/maintenance" },
            { w: "renovate", d: "put (a building) into good condition" },
            { w: "burden", d: "a heavy responsibility/a difficult problem" },
            { w: "immense", d: "extremely large" },
            { w: "specialized", d: "particular/specific" },
            { w: "comprehensive", d: "including all aspects" },
            { w: "functionality", d: "usefulness" },
            { w: "codes", d: "rules/regulations" },
            { w: "adapting", d: "changing something to make it suitable" },
            { w: "prohibitively", d: "so high or so much that it prevents something from being done" },
            { w: "demolish", d: "completely destroy a building or structure" },
            { w: "philosophies", d: "sets of beliefs that guide behavior" },
            { w: "emphasizes", d: "gives special attention to" },
            { w: "authenticity", d: "the quality of being real/genuine" },
            { w: "particularly", d: "especially, mostly" },
            { w: "continuous", d: "uninterrupted/nonstop" },
            { w: "spiritual", d: "relating to the soul" }
        ];

        let currentIndex = 0;
        let currentList = [];
        let isRevealed = false;
        let pauseTimer = null; // To manage the silence timer

        // Voice caching
        let preferredVoice = null;
        window.speechSynthesis.onvoiceschanged = loadVoices;
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            // Try to find a high-quality US English voice (common on iPhone)
            // Priority: Samantha (iOS), Google US English, then any en-US
            preferredVoice = voices.find(v => v.name === 'Samantha') || 
                             voices.find(v => v.name === 'Google US English') ||
                             voices.find(v => v.lang === 'en-US');
        }
        loadVoices(); // Initial try

        function startQuiz() {
            const shouldShuffle = document.getElementById('shuffleCheck').checked;
            currentList = [...vocabData];
            
            if (shouldShuffle) {
                for (let i = currentList.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [currentList[i], currentList[j]] = [currentList[j], currentList[i]];
                }
            }

            currentIndex = 0;
            document.getElementById('startBtn').innerText = "Restart";
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('replayBtn').disabled = false;
            
            // On iOS, voices might not load until first interaction, try loading again
            if(!preferredVoice) loadVoices();

            loadQuestion();
        }

        function loadQuestion() {
            if (currentIndex >= currentList.length) {
                alert("Quiz Finished!");
                return;
            }

            // Clear any pending timers from previous question
            if (pauseTimer) clearTimeout(pauseTimer);
            window.speechSynthesis.cancel();

            const item = currentList[currentIndex];
            isRevealed = false;

            document.getElementById('counter').innerText = `${currentIndex + 1} / ${currentList.length}`;
            document.getElementById('wordText').innerText = "???";
            document.getElementById('wordText').style.color = "#cbd5e0";
            document.getElementById('defText').innerText = "(Listening...)";
            document.querySelector('.content-area').style.backgroundColor = "white";

            playAudio();
        }

        function playAudio() {
            if (currentIndex >= currentList.length) return;
            // Clear timer and speech to prevent overlap
            if (pauseTimer) clearTimeout(pauseTimer);
            window.speechSynthesis.cancel();
            
            const item = currentList[currentIndex];
            if(!item.w) return;

            const firstChar = item.w.trim().charAt(0);

            // --- iOSÂØæÂøú: 2ÊÆµÈöéË™≠„Åø‰∏ä„ÅíÊñπÂºè ---
            
            // 1. ÂÆöÁæ©Êñá„ÅÆ‰ΩúÊàê
            const utterDef = new SpeechSynthesisUtterance(item.d);
            utterDef.lang = 'en-US';
            utterDef.rate = 0.9; // Â∞ë„Åó„ÇÜ„Å£„Åè„Çä
            if(preferredVoice) utterDef.voice = preferredVoice;

            // 2. ÂÆöÁæ©Êñá„ÅåÁµÇ„Çè„Å£„ÅüÂæå„ÅÆÂá¶ÁêÜ
            utterDef.onend = function() {
                // „Åì„Åì„ÅßJavaScript„ÅÆ„Çø„Ç§„Éû„Éº„Çí‰Ωø„Å£„Å¶„ÄåÊú¨ÂΩì„ÅÆÈñì„Äç„Çí‰Ωú„ÇãÔºà1.2ÁßíÔºâ
                pauseTimer = setTimeout(() => {
                    // 3. „Éí„É≥„Éà„ÅÆË™≠„Åø‰∏ä„Åí
                    const utterHint = new SpeechSynthesisUtterance(`Starts with ${firstChar}`);
                    utterHint.lang = 'en-US';
                    utterHint.rate = 0.85; // „Éí„É≥„Éà„ÅØ„Åï„Çâ„Å´Â∞ë„Åó„ÇÜ„Å£„Åè„Çä
                    if(preferredVoice) utterHint.voice = preferredVoice;
                    
                    window.speechSynthesis.speak(utterHint);
                }, 400); // 1200ms = 1.2Áßí„ÅÆÂÆåÂÖ®„Å™Ê≤àÈªô
            };

            // ÊúÄÂàù„ÅÆÁô∫Ë©±„ÇíÈñãÂßã
            window.speechSynthesis.speak(utterDef);
        }

        function revealAnswer() {
            if (isRevealed || currentList.length === 0) return;
            
            const item = currentList[currentIndex];
            
            document.getElementById('wordText').innerText = item.w;
            document.getElementById('wordText').style.color = "#2b6cb0";
            document.getElementById('defText').innerText = item.d;
            document.querySelector('.content-area').style.backgroundColor = "#e6fffa";
            
            isRevealed = true;
        }

        function nextQuestion() {
            if (!isRevealed) {
                if (pauseTimer) clearTimeout(pauseTimer);
                window.speechSynthesis.cancel();
            }
            currentIndex++;
            loadQuestion();
        }

        // --- Keyboard Support ---
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                event.preventDefault();
                if (!isRevealed) revealAnswer();
            }
            if (event.code === 'ArrowRight') {
                if(document.getElementById('nextBtn').disabled === false) {
                   nextQuestion();
                }
            }
        });
    </script>
</body>
</html>
